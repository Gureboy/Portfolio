<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D&D Easter Egg - Daniel Salini Portfolio</title>
  <meta name="description" content="Juego roguelike D&D por turnos creado por Daniel Salini - Sistema d20, 8 clases, combate estratégico">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎲</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0a0e1a;
      --bg-secondary: #1a2332;
      --bg-panel: #2d3748;
      --accent-gold: #ff7a00;
      --accent-red: #e53e3e;
      --accent-green: #38a169;
      --accent-blue: #3182ce;
      --text-primary: #f7fafc;
      --text-secondary: #cbd5e0;
      --border-color: #4a5568;
      --shadow-dark: rgba(0, 0, 0, 0.6);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      font-family: 'Roboto Mono', monospace;
      min-height: 100vh;
      line-height: 1.6;
      position: relative;
    }

    /* Back to portfolio button */
    .back-to-portfolio {
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--accent-gold);
      color: var(--bg-dark);
      padding: 12px 18px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 15px rgba(255, 122, 0, 0.3);
    }

    .back-to-portfolio:hover {
      background: #e06800;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 122, 0, 0.4);
    }

    .main {
      max-width: 1000px;
      margin: 0 auto;
      padding: 80px 20px 40px;
    }

    /* Game header */
    .game-header {
      text-align: center;
      margin-bottom: 40px;
      background: var(--bg-panel);
      padding: 30px;
      border-radius: 20px;
      border: 2px solid var(--accent-gold);
      box-shadow: 0 10px 30px var(--shadow-dark);
    }

    .game-title {
      font-family: 'Cinzel', serif;
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 600;
      color: var(--accent-gold);
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      margin-bottom: 10px;
    }

    .game-subtitle {
      font-size: 1.1em;
      color: var(--text-secondary);
      font-style: italic;
      margin-bottom: 15px;
    }

    .game-features {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      font-size: 0.9em;
      opacity: 0.8;
    }

    .feature {
      background: rgba(255, 122, 0, 0.1);
      padding: 5px 12px;
      border-radius: 15px;
      border: 1px solid rgba(255, 122, 0, 0.3);
    }

    /* Game container */
    #game {
      background: var(--bg-panel);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px var(--shadow-dark);
      border: 1px solid var(--border-color);
      min-height: 400px;
    }

    .section {
      margin: 25px 0;
      padding: 25px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 15px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    }

    .section h2 {
      color: var(--accent-gold);
      margin-bottom: 20px;
      font-family: 'Cinzel', serif;
      font-size: 1.5em;
    }

    /* Form elements */
    .choices {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .choices label {
      background: linear-gradient(135deg, var(--bg-panel), #3a4553);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 15px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      font-weight: 500;
    }

    .choices input[type=radio], 
    .choices input[type=checkbox] {
      margin-right: 12px;
      accent-color: var(--accent-gold);
    }

    .choices label:hover {
      background: linear-gradient(135deg, var(--accent-gold), #b8941f);
      border-color: var(--accent-gold);
      color: var(--bg-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(255, 122, 0, 0.3);
    }

    .choices input:checked + label {
      background: linear-gradient(135deg, var(--accent-gold), #b8941f);
      border-color: var(--accent-gold);
      color: var(--bg-dark);
    }

    /* Buttons */
    .btn {
      background: linear-gradient(135deg, var(--bg-panel), #3a4553);
      color: var(--text-primary);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 15px 25px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      margin: 8px;
      transition: all 0.3s ease;
      font-family: inherit;
      display: inline-block;
      text-decoration: none;
    }

    .btn:hover {
      background: linear-gradient(135deg, var(--accent-gold), #b8941f);
      border-color: var(--accent-gold);
      color: var(--bg-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(255, 122, 0, 0.3);
    }

    .btn.big-btn {
      padding: 18px 30px;
      font-size: 1.2em;
    }

    /* Game elements */
    .log, .combat-log, .combat-history {
      background: var(--bg-dark);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid var(--border-color);
      min-height: 120px;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.95em;
      max-height: 300px;
      overflow-y: auto;
      scroll-behavior: smooth;
      contain: layout style paint;
    }

    .combat-history {
      max-height: 200px;
      font-size: 0.9em;
    }

    .enemy { 
      color: var(--accent-red); 
      font-weight: bold; 
    }

    .player { 
      color: var(--accent-green); 
      font-weight: bold; 
    }

    .shop, .shop-items {
      background: var(--bg-dark);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid var(--border-color);
    }

    .shop-item {
      background: var(--bg-secondary);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      border: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .hidden { 
      display: none; 
    }

    /* Loading screen */
    .loading {
      text-align: center;
      padding: 60px;
    }

    .dice-spinner {
      font-size: 4em;
      animation: spin 2s linear infinite;
      margin-bottom: 20px;
      transform: translateZ(0); /* Force GPU acceleration */
      backface-visibility: hidden;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Footer */
    .game-footer {
      text-align: center;
      margin-top: 40px;
      padding: 25px;
      color: var(--text-secondary);
      font-size: 0.9em;
      background: var(--bg-panel);
      border-radius: 15px;
      border: 1px solid var(--border-color);
    }

    .game-footer a {
      color: var(--accent-gold);
      text-decoration: none;
    }

    .game-footer a:hover {
      text-decoration: underline;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .main {
        padding: 60px 15px 20px;
      }

      .game-header {
        padding: 20px 15px;
        margin-bottom: 25px;
      }

      .game-title {
        font-size: 1.8em;
      }

      .game-features {
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      #game {
        padding: 20px 15px;
      }

      .section {
        padding: 20px 15px;
        margin: 20px 0;
      }

      .choices {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .btn {
        padding: 12px 20px;
        margin: 5px;
        font-size: 1em;
      }

      .back-to-portfolio {
        position: relative;
        top: auto;
        left: auto;
        margin: 15px auto;
        display: inline-flex;
      }
    }

    /* Accessibility improvements */
    @media (prefers-reduced-motion: reduce) {
      .dice-spinner {
        animation: none;
      }
      
      * {
        transition: none !important;
        animation: none !important;
      }
      
      .btn:hover, .choices label:hover {
        transform: none !important;
      }
    }

    /* High contrast mode */
    @media (prefers-contrast: high) {
      :root {
        --bg-dark: #000;
        --bg-secondary: #111;
        --bg-panel: #222;
        --text-primary: #fff;
        --border-color: #666;
      }
    }

    /* Performance optimizations */
    * {
      will-change: auto;
    }

    /* Only apply will-change to elements that actually animate */
    .dice-spinner,
    .btn:hover,
    .back-to-portfolio:hover,
    .choices label:hover {
      will-change: transform;
    }

    /* Optimize animations */
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .dice-spinner {
      font-size: 4em;
      animation: spin 2s linear infinite;
      margin-bottom: 20px;
      transform: translateZ(0); /* Force GPU acceleration */
      backface-visibility: hidden;
    }

    /* Optimize scrolling */
    .log, .combat-log, .combat-history {
      /* ...existing code... */
      scroll-behavior: smooth;
      contain: layout style paint;
    }

    /* Optimize layout calculations */
    .section {
      /* ...existing code... */
      contain: layout style;
    }

    /* Reduce repaints */
    .choices label {
      /* ...existing code... */
      contain: layout style paint;
    }

    /* Memory optimization for mobile */
    @media (max-width: 768px) {
      .section {
        contain: layout;
      }
      
      .choices {
        contain: layout;
      }
      
      /* Reduce complexity on mobile */
      .game-header {
        box-shadow: 0 5px 15px var(--shadow-dark);
      }
      
      #game {
        box-shadow: 0 5px 15px var(--shadow-dark);
      }
    }

    /* Performance for low-end devices */
    @media (max-resolution: 1dppx) {
      .btn, .choices label {
        box-shadow: none;
      }
      
      .game-header, #game {
        box-shadow: 0 2px 8px var(--shadow-dark);
      }
    }

    /* Reduce motion for better performance */
    @media (prefers-reduced-motion: reduce) {
      .dice-spinner {
        animation: none;
      }
      
      * {
        transition: none !important;
        animation: none !important;
      }
      
      .btn:hover, .choices label:hover {
        transform: none !important;
      }
    }

    /* Critical CSS only - defer non-critical styles */
    .game-stats {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.8);
      color: var(--accent-gold);
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.7em;
      font-family: monospace;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 999;
      pointer-events: none;
    }

    .game-stats.show {
      opacity: 1;
    }

    /* Optimize for battery saving */
    @media (prefers-reduced-data: reduce) {
      .game-header {
        background: var(--bg-panel);
        box-shadow: none;
      }
      
      #game {
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
  <!-- Performance stats -->
  <div id="game-stats" class="game-stats"></div>

  <a href="index.html" class="back-to-portfolio">
    <span>←</span>
    <span>Volver al Portfolio</span>
  </a>

  <div class="main">
    <header class="game-header">
      <h1 class="game-title">⚔️ D&D Easter Egg ⚔️</h1>
      <p class="game-subtitle">Roguelike D&D por Turnos Clásico</p>
      <div class="game-features">
        <span class="feature">Sistema d20</span>
        <span class="feature">8 Clases Jugables</span>
        <span class="feature">Combat por Turnos</span>
        <span class="feature">Items Legendarios</span>
        <span class="feature">Sistema de Niveles</span>
      </div>
    </header>

    <main id="game">
      <div class="loading">
        <div class="dice-spinner">🎲</div>
        <p>Cargando aventura...</p>
        <p style="font-size: 0.9em; opacity: 0.7; margin-top: 10px;">
          Preparando mazmorras, monstruos y tesoros...
        </p>
      </div>
    </main>

    <footer class="game-footer">
      <p>
        🎮 <strong>Creado por <a href="index.html">Daniel Salini</a></strong> 🎮
      </p>
      <p style="margin-top: 15px; font-size: 0.8em; opacity: 0.8;">
        Sistema d20 | Turn-based Combat | Completamente funcional en JavaScript vanilla
      </p>
      <p style="margin-top: 10px; font-size: 0.7em; opacity: 0.6;">
        Inspirado en D&D 5e | Easter Egg del Portfolio Profesional
      </p>
    </footer>
  </div>

  <script>
    // Performance monitoring
    const GamePerformance = {
      startTime: performance.now(),
      frameCount: 0,
      fps: 0,
      memory: 0,
      
      init() {
        this.monitorFPS();
        this.monitorMemory();
        this.setupDebouncing();
      },
      
      monitorFPS() {
        const measureFPS = () => {
          this.frameCount++;
          const now = performance.now();
          const elapsed = now - this.startTime;
          
          if (elapsed >= 1000) {
            this.fps = Math.round((this.frameCount * 1000) / elapsed);
            this.frameCount = 0;
            this.startTime = now;
            this.updateStats();
          }
          
          requestAnimationFrame(measureFPS);
        };
        requestAnimationFrame(measureFPS);
      },
      
      monitorMemory() {
        if (performance.memory) {
          setInterval(() => {
            this.memory = Math.round(performance.memory.usedJSHeapSize / 1048576);
            this.updateStats();
          }, 2000);
        }
      },
      
      updateStats() {
        const statsEl = document.getElementById('game-stats');
        if (this.fps > 0) {
          const memoryText = this.memory > 0 ? ` | ${this.memory}MB` : '';
          statsEl.textContent = `FPS: ${this.fps}${memoryText}`;
          
          // Show warning if performance is poor
          if (this.fps < 30 || this.memory > 100) {
            statsEl.style.color = '#e53e3e';
            statsEl.classList.add('show');
          } else {
            statsEl.style.color = '#38a169';
            setTimeout(() => statsEl.classList.remove('show'), 3000);
          }
        }
      },
      
      setupDebouncing() {
        // Debounce resize events
        let resizeTimeout;
        window.addEventListener('resize', () => {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(() => {
            this.optimizeForViewport();
          }, 250);
        });
      },
      
      optimizeForViewport() {
        const game = document.getElementById('game');
        const isMobile = window.innerWidth < 768;
        
        if (isMobile) {
          // Reduce complexity on mobile
          game.style.boxShadow = '0 5px 15px rgba(0,0,0,0.3)';
        } else {
          game.style.boxShadow = '0 10px 30px rgba(0,0,0,0.6)';
        }
      }
    };

    // Optimize DOM operations
    const DOMOptimizer = {
      updateQueue: [],
      isUpdating: false,
      
      queueUpdate(element, property, value) {
        this.updateQueue.push({ element, property, value });
        if (!this.isUpdating) {
          this.processQueue();
        }
      },
      
      processQueue() {
        this.isUpdating = true;
        requestAnimationFrame(() => {
          const fragment = document.createDocumentFragment();
          
          this.updateQueue.forEach(({ element, property, value }) => {
            if (property === 'innerHTML') {
              element.innerHTML = value;
            } else {
              element.style[property] = value;
            }
          });
          
          this.updateQueue = [];
          this.isUpdating = false;
        });
      }
    };

    // Memory management
    const MemoryManager = {
      cleanup() {
        // Clear unused variables
        if (window.DUNGEON && window.DUNGEON.length > 1000) {
          window.DUNGEON = window.DUNGEON.slice(-100);
        }
        
        // Force garbage collection if available
        if (window.gc) {
          window.gc();
        }
      },
      
      setupAutoCleanup() {
        setInterval(() => {
          this.cleanup();
        }, 30000); // Clean up every 30 seconds
      }
    };

    // Initialize performance optimizations
    document.addEventListener('DOMContentLoaded', () => {
      GamePerformance.init();
      MemoryManager.setupAutoCleanup();
      
      // Preload critical resources
      const link = document.createElement('link');
      link.rel = 'prefetch';
      link.href = 'dnd-easter-egg.js';
      document.head.appendChild(link);
    });

    // Optimize event listeners
    const throttle = (func, limit) => {
      let inThrottle;
      return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
          func.apply(context, args);
          inThrottle = true;
          setTimeout(() => inThrottle = false, limit);
        }
      };
    };

    // Export for use in game script
    window.GameOptimizer = {
      DOMOptimizer,
      MemoryManager,
      throttle
    };
  </script>

  <script src="dnd-easter-egg.js"></script>
</body>
</html>
